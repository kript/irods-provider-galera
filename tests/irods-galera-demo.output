
### clean up from prior run ###
### create docker network galeranet if it does not exist ###
### stop / remove existing containers ###
irods-galera-1
irods-galera-2
irods-galera-3
irods-galera-1
irods-galera-2
irods-galera-3
### init irods-galera-1 ###
f7e9228e41c49460d227faeec7db6c5d48b743e76c51e74e0459ad30ebb6787e
...
### init irods-galera-2 ###
fc665954bc86107f0b162745def35a702fb35df1a17d971f8b710beb1eb00a65
...
### init irods-galera-3 ###
a482d8aee006e85c4e6fb2ca100e471449eab0756590376aede4447ee076b25d
...
Creating resource:
Name:		"galera1"
Type:		"unixfilesystem"
Host:		"irods-galera-1"
Path:		"/Vault"
Context:	""
### ienv irods-galera-1 ###
irods_version - 4.2.0
irods_host - irods-galera-1
irods_transfer_buffer_size_for_parallel_transfer_in_megabytes - 4
irods_zone_name - galeraZone
irods_user_name - rods
irods_server_control_plane_encryption_num_hash_rounds - 16
schema_version - v3
irods_encryption_salt_size - 8
irods_default_resource - galera1
irods_encryption_num_hash_rounds - 16
irods_home - /galeraZone/home/rods
irods_encryption_key_size - 32
irods_match_hash_policy - compatible
irods_environment_file - /var/lib/irods/.irods/irods_environment.json
irods_default_number_of_transfer_threads - 4
irods_encryption_algorithm - AES-256-CBC
irods_server_control_plane_encryption_algorithm - AES-256-CBC
schema_name - irods_environment
irods_default_hash_scheme - SHA256
irods_client_server_policy - CS_NEG_REFUSE
irods_session_environment_file - /var/lib/irods/.irods/irods_environment.json.0
irods_port - 1247
irods_maximum_size_for_single_buffer_in_megabytes - 32
irods_cwd - /galeraZone/home/rods
irods_server_control_plane_port - 1248
irods_server_control_plane_key - TEMPORARY__32byte_ctrl_plane_key
irods_client_server_negotiation - request_server_negotiation
...
Creating resource:
Name:		"galera2"
Type:		"unixfilesystem"
Host:		"irods-galera-2"
Path:		"/Vault"
Context:	""
### ienv irods-galera-2 ###
irods_version - 4.2.0
schema_name - irods_environment
irods_server_control_plane_encryption_algorithm - AES-256-CBC
irods_user_name - rods
irods_host - irods-galera-2
irods_zone_name - galeraZone
irods_transfer_buffer_size_for_parallel_transfer_in_megabytes - 4
irods_session_environment_file - /var/lib/irods/.irods/irods_environment.json.0
irods_port - 1247
irods_default_resource - galera2
irods_encryption_num_hash_rounds - 16
irods_home - /galeraZone/home/rods
irods_match_hash_policy - compatible
schema_version - v3
irods_encryption_salt_size - 8
irods_encryption_key_size - 32
irods_encryption_algorithm - AES-256-CBC
irods_default_hash_scheme - SHA256
irods_maximum_size_for_single_buffer_in_megabytes - 32
irods_cwd - /galeraZone/home/rods
irods_server_control_plane_encryption_num_hash_rounds - 16
irods_environment_file - /var/lib/irods/.irods/irods_environment.json
irods_default_number_of_transfer_threads - 4
irods_client_server_policy - CS_NEG_REFUSE
irods_server_control_plane_port - 1248
irods_server_control_plane_key - TEMPORARY__32byte_ctrl_plane_key
irods_client_server_negotiation - request_server_negotiation
...
Creating resource:
Name:		"galera3"
Type:		"unixfilesystem"
Host:		"irods-galera-3"
Path:		"/Vault"
Context:	""
### ienv irods-galera-3 ###
irods_version - 4.2.0
irods_server_control_plane_encryption_algorithm - AES-256-CBC
schema_name - irods_environment
irods_transfer_buffer_size_for_parallel_transfer_in_megabytes - 4
irods_host - irods-galera-3
irods_zone_name - galeraZone
irods_user_name - rods
irods_server_control_plane_encryption_num_hash_rounds - 16
irods_maximum_size_for_single_buffer_in_megabytes - 32
irods_session_environment_file - /var/lib/irods/.irods/irods_environment.json.0
irods_port - 1247
irods_match_hash_policy - compatible
irods_default_resource - galera3
irods_encryption_num_hash_rounds - 16
irods_home - /galeraZone/home/rods
schema_version - v3
irods_encryption_salt_size - 8
irods_environment_file - /var/lib/irods/.irods/irods_environment.json
irods_default_number_of_transfer_threads - 4
irods_client_server_policy - CS_NEG_REFUSE
irods_default_hash_scheme - SHA256
irods_cwd - /galeraZone/home/rods
irods_encryption_key_size - 32
irods_server_control_plane_port - 1248
irods_server_control_plane_key - TEMPORARY__32byte_ctrl_plane_key
irods_client_server_negotiation - request_server_negotiation
irods_encryption_algorithm - AES-256-CBC
### list resources in galeraZone ###
[rods@irods-galera-1]$ iadmin lr
bundleResc
galera1
galera2
galera3
### create rodsuser named bob with password bob ###
[rods@irods-galera-2]$ iadmin mkuser bob rodsuser
[rods@irods-galera-2]$ iadmin moduser bob password bob
### add files as user bob to each galera resource ###
[bob@localhost]$ iput -R galera2 AAAAA.txt
[bob@localhost]$ iput -R galera3 BBBBB.txt
[bob@localhost]$ iput -R galera1 CCCCC.txt
### show bob's files in each resource in iRODS ###
[rods@irods-galera-3]$ ils -Lr /galeraZone/home/bob
/galeraZone/home/bob:
  bob               0 galera2            6 2017-04-26.16:54 & AAAAA.txt
        generic    /Vault/home/bob/AAAAA.txt
  bob               0 galera3            6 2017-04-26.16:54 & BBBBB.txt
        generic    /Vault/home/bob/BBBBB.txt
  bob               0 galera1            6 2017-04-26.16:54 & CCCCC.txt
        generic    /Vault/home/bob/CCCCC.txt
### show bob's files in each Vault ###
[user@localhost]$ ls -alh /home/docker/galera1/home/bob
total 12K
drwxr-x--- 2 996 996 4.0K Apr 26 12:54 .
drwxr-x--- 4 996 996 4.0K Apr 26 12:54 ..
-rw------- 1 996 996    6 Apr 26 12:54 CCCCC.txt
[user@localhost]$ ls -alh /home/docker/galera2/home/bob
total 12K
drwxr-x--- 2 996 996 4.0K Apr 26 12:54 .
drwxr-x--- 4 996 996 4.0K Apr 26 12:54 ..
-rw------- 1 996 996    6 Apr 26 12:54 AAAAA.txt
[user@localhost]$ ls -alh /home/docker/galera3/home/bob
total 12K
drwxr-x--- 2 996 996 4.0K Apr 26 12:54 .
drwxr-x--- 4 996 996 4.0K Apr 26 12:54 ..
-rw------- 1 996 996    6 Apr 26 12:54 BBBBB.txt
### shut down irods-galera-2 ###
[user@localhost]$ docker stop irods-galera-2 && docker rm -fv irods-galera-2
irods-galera-2
irods-galera-2
[user@localhost]$ docker ps -a
CONTAINER ID        IMAGE               COMMAND                  CREATED              STATUS              PORTS                                                NAMES
a482d8aee006        irods-galera        "/docker-entrypoin..."   55 seconds ago       Up 54 seconds       1247-1248/tcp, 3306/tcp, 4567/tcp, 20000-20199/tcp   irods-galera-3
f7e9228e41c4        irods-galera        "/docker-entrypoin..."   About a minute ago   Up About a minute   1247-1248/tcp, 3306/tcp, 4567/tcp, 20000-20199/tcp   irods-galera-1
### iput new resource into galera3 ###
[bob@localhost]$ iput -R galera3 DDDDD.txt
[bob@localhost]$ ils -Lr
/galeraZone/home/bob:
  bob               0 galera2            6 2017-04-26.16:54 & AAAAA.txt
        generic    /Vault/home/bob/AAAAA.txt
  bob               0 galera3            6 2017-04-26.16:54 & BBBBB.txt
        generic    /Vault/home/bob/BBBBB.txt
  bob               0 galera1            6 2017-04-26.16:54 & CCCCC.txt
        generic    /Vault/home/bob/CCCCC.txt
  bob               0 galera3            6 2017-04-26.16:55 & DDDDD.txt
        generic    /Vault/home/bob/DDDDD.txt
### attempt to get file from galera2 ###
[bob@localhost]$ iget AAAAA.txt bob-AAAAA.txt
remote addresses: 172.18.0.4 ERROR: getUtil: get error for bob-AAAAA.txt status = -305111 USER_SOCK_CONNECT_ERR, Connection refused
### bring back irods-galera-2 ###
### init irods-galera-2 ###
e9c5f8e4a9c1165852dd4dc5e4fd4b38673414d2a40d546ffa447cc88b5cf633
...
### show database on irods-galera-2 is synchronized ###
[rods@irods-galera-2]$ ils -Lr /galeraZone/home/bob
/galeraZone/home/bob:
  bob               0 galera2            6 2017-04-26.16:54 & AAAAA.txt
        generic    /Vault/home/bob/AAAAA.txt
  bob               0 galera3            6 2017-04-26.16:54 & BBBBB.txt
        generic    /Vault/home/bob/BBBBB.txt
  bob               0 galera1            6 2017-04-26.16:54 & CCCCC.txt
        generic    /Vault/home/bob/CCCCC.txt
  bob               0 galera3            6 2017-04-26.16:55 & DDDDD.txt
        generic    /Vault/home/bob/DDDDD.txt
### iget resource from newly spawned irods-galera-2 ###
[bob@localhost]$ iget -f AAAAA.txt bob-AAAAA.txt
[bob@localhost]$ ls -alh
-rw-r----- 1 docker docker   6 Apr 26  2017 bob-AAAAA.txt
